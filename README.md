[![License: CC BY-NC-SA 4.0](https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-ff69b4.svg)](http://creativecommons.org/licenses/by-nc-sa/4.0/)

## AR-VAE: Attribute-based Regularization of VAE Latent Spaces
VAE:基于属性的潜空间正则化
### About 
AR-VAE is a type of Variational Auto-Encoder (VAE) which uses a new supervised training method to create structured latent spaces where specific continuous-valued attributes are forced to be encoded along specific dimensions of the latent space. This repository contains the source for training and evaluating the AR-VAE models across different image and music-based datasets.
The figure below shows the main idea behind the AR-VAE model.

AR-VAE是一种变分自动编码器(VAE)，它使用一种新的监督训练方法来创建结构化潜在空间，其中特定的连续值属性被迫沿着潜在空间的特定维度进行编码。该存储库包含跨不同的基于图像和音乐的数据集训练和评估vae模型的源。
下图显示了AR-VAE模型背后的主要思想。
<p align="center">
    <img src=figs/motivation_arvae.svg width=500px><br>
</p>

This repository contains the source for training and evaluating the AR-VAE models across different image and music-based datasets. Please cite as follows if you are using the code in this repository in any manner.

该存储库包含跨不同的基于图像和音乐的数据集训练和评估vae模型的源。如果您以任何方式使用此存储库中的代码，请引用以下代码。

> Ashis Pati, Alexander Lerch. "Attribute-based Regularization of Latent Spaces for Variational Auto-Encoders", Neural Computing and Applications. 2020.


```
@article{pati2020arvae,
  title={{Attribute-based Regularization of Latent Spaces for Variational Auto-Encoders}},
  author={Pati, Ashis and Lerch, Alexander},
  journal={Neural Computing and Applications},
  issn={1433-3058},
  doi={10.1007/s00521-020-05270-2},
  url={https://doi.org/10.1007/s00521-020-05270-2},
  year={2020},
}
```


### Results

**Manipulation of Image Attributes**

Manipulating attributes of 2-d shapes. Each row in the figure below represents a unique shape (from top to bottom): <i>square, heart, ellipse</i>. Each column corresponds to traversal along a regularized dimension which encodes a specific attribute (from left to right): *Shape, Scale, Orientation, x-position, y-position*.

**处理图像属性**

处理二维形状的属性。下图中的每一行代表一个独特的形状(从上到下):<i>正方形，心形，椭圆形</i>。每一列都对应于正则化维度的遍历，该维度编码特定属性(从左到右):*形状、比例、方向、x位置、y位置*。

<p align="center">
    <img src=figs/gif_interpolations_dsprites_0.gif><br>
    <img src=figs/gif_interpolations_dsprites_1.gif><br>
    <img src=figs/gif_interpolations_dsprites_4.gif><br>
   
</p>


Manipulating attributes of MNIST digits. Each row in the figure below represents a unique digit from 0 to 9. Each column corresponds to traversal along a regularized dimension which encodes a specific attribute (from left to right): *Area, Length, Thickness, Slant, Width, Height*.

操作MNIST数字的属性。下图中的每一行表示一个唯一的数字从0到9。每一列都对应于一个正则化维度的遍历，该维度编码特定属性(从左到右):*面积、长度、厚度、斜度、宽度、高度*。

<p align="center">
    <img src=figs/gif_interpolations_mnist_28.gif><br>
    <img src=figs/gif_interpolations_mnist_5.gif><br>
    <img src=figs/gif_interpolations_mnist_1.gif><br>
    <img src=figs/gif_interpolations_mnist_30.gif><br>
    <img src=figs/gif_interpolations_mnist_19.gif><br>
    <img src=figs/gif_interpolations_mnist_23.gif><br>
    <img src=figs/gif_interpolations_mnist_21.gif><br>
    <img src=figs/gif_interpolations_mnist_17.gif><br>
    <img src=figs/gif_interpolations_mnist_61.gif><br>
    <img src=figs/gif_interpolations_mnist_9.gif><br>
</p>

**Manipulation of Musical Attributes**

Manipulating attributes of monophonic measures of music. In the figure below, measures on each staff line are generated by traversal along a regularized dimension which encodes a specific musical attribute (shown on the extreme left).

**音乐属性的操作**

操纵音乐单音部手法的属性。在下面的图中，每个五线谱线上的度量是通过遍历编码特定音乐属性的正则化维度生成的(如最左边所示)。

<p align="center">
    <img src=figs/interp_score_15_11.svg><br>
</p>

Piano roll version of the figure above is shown below. Plots on the right of each pianoroll show the progression of attribute values.

钢琴卷版的上图如下图所示。每个钢琴卷右边的图形显示属性值的顺序。

<p align="center">
    <img src=figs/interp_pianoroll_15_11.svg><br>
</p>    


### Installation and Usage
Install `anaconda` or `miniconda` by following the instruction 

###安装和使用

按说明安装“anaconda”或“miniconda”

[here](https://docs.conda.io/projects/conda/en/latest/user-guide/install/).

Create a new conda environment using the `enviroment.yml` file located in the root folder of this repository. The instructions for the same can be found [here](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file).

使用“环境”创建一个新的conda环境。yml的文件位于这个存储库的根文件夹中。同样的指令可以在这里找到

To install, either download / clone this repository. Open a new terminal, `cd` into the root folder of this repository and run the following command

要安装，下载/克隆这个存储库。在这个存储库的根文件夹中打开一个新的终端' cd '，并运行以下命令

    python setup.py develop

**Downloading Datasets:**

Follow the steps below to download the different datasets: 
* Create a folder named `mnist_data` in `ar-vae/data/` directory. Download the morpho-mist data from this [link](https://drive.google.com/uc?export=download&id=1-E3sbKtzN8NGNefUdky2NVniW1fAa5ZG) and copy the folder named `plain` to the created `mnist_data` folder.
* Create a folder named `dsprites` in `ar-vae/data/` directory. Clone [this](https://github.com/deepmind/dsprites-dataset) repository and copy its contents to the created `dpsrites` folder.
* Download the `.zip` file linked [here](https://drive.google.com/file/d/1yvkm0ebyG3XAZ97ZRaiumFUAmlXkY1bA/view?usp=sharing). Unzip it and place the `datasets` and `folk_raw_data` folders in the `ar-vae/data/` directory.

The final `ar-vae/data/` directory should have the following sub-directories:

下载数据集:* * * *

按以下步骤下载不同的数据集:
*在ar-vae/data/ '目录中创建一个名为mnist_data的文件夹。从这个[链接](https://drive.google.com/uc?export=download&id=1-E3sbKtzN8NGNefUdky2NVniW1fAa5ZG)下载morpho-mist数据，并将名为“plain”的文件夹复制到创建的“mnist_data”文件夹中。
在ar-vae/data/ '目录中创建一个名为' dsprites '的文件夹。克隆[this](https://github.com/deepmind/dsprites-dataset)存储库并将其内容复制到创建的' dps仪式'文件夹中。
*下载“。zip '文件链接[此处](https://drive.google.com/file/d/1yvkm0ebyG3XAZ97ZRaiumFUAmlXkY1bA/view?usp=sharing)。解压缩它并将“datasets”和“folk_raw_data”文件夹放在“ar-vae/data/”目录中。
最终的' ar-vae/data/ '目录应该有以下子目录:

```
ar-vae/data
    --> dataloaders
        --> morphomnist
    --> datasets
    --> dpsprites
    --> folk_raw_data
    --> mnist_data
        --> plain
```

### Contents
The contents of this repository are as follows: 
* `data`: contains the data and pytorch `dataloaders` for the different datasets.
* `imagevae`: module implementing the AR-VAE network and trainer for image datasets.
* `measurevae`: module implemening the AR-VAE network and trainer for music datasets. 
* `imagefader`: module implementing the fader network and trainer for image datasets.
* `figs`: contains figures and plots for different experiments.
* `utils`: module with utility classes and methods for model, training, evaluation and plotting.

* other scripts to train / test the models


# # #内容

该存储库的内容如下:
* ' data ':包含不同数据集的数据和pytorch ' dataloaders '。
* imagevae:用于图像数据集的vae网络和培训器模块。
* measurevae:模块实现针对音乐数据集的vae网络和培训器。
* ' imagefader ':用于图像数据集的fader网络和训练器模块。
* ' figs ':包含不同实验的图形和图。
* utils:模块，带有用于建模、培训、评估和绘图的实用工具类和方法。
* 其他用于培训/测试模型的脚本
